---
title: "Правила работы с контекстом проекта SVAIB"
updated: 2025-12-02
version: 15
scope: "always"
priority: critical
---

# Правила работы с контекстом SVAIB

## Кратко

Система управления контекстом для AI-навигации по файлам проекта. Иерархическая структура: CLAUDE.md/README.md в корне → README папок → файлы с [SOURCE]/[REF:] и связями.

## Связанные файлы

- editor_context_prompt.md — процесс работы агента-редактора (использует эти правила)
- storage_system.md — физическое хранение (Git + Google Drive)

---

## 1. Ключевой принцип

**Иерархическая навигация "сверху вниз":**

```
CLAUDE.md (корень) → детальный контекст для Claude Code
README.md (корень) → описание проекта для людей/GitHub
    └── README.md папки → что внутри, какой файл читать
        └── Файл → информация с [SOURCE]/[REF:] + связанные файлы
```

AI читает сверху вниз:
1. CLAUDE.md (корень) → понимает как работать с проектом
2. README папки → понимает что внутри
3. Конкретный файл → получает информацию + видит связи

---

## 2. README.md vs CLAUDE.md

**Это разные файлы с разными целями:**

| Файл | Для кого | Назначение |
|------|----------|-----------|
| README.md | Люди, GitHub, клиенты | "Что это за проект" |
| CLAUDE.md | Claude Code | "Конституция" для AI — как работать с кодом |

---

## 3. Структура файлов системы

| Файл | Назначение |
|------|-----------|
| `README.md` (корень) | Описание проекта для людей/GitHub |
| `CLAUDE.md` (корень) | Детальный контекст для Claude Code |
| `meta/README.md` | Навигация по meta/ |
| `meta/CLAUDE.md` | `@README.md` (импорт для Claude Code) |
| `dev/README.md` | Навигация по dev/ |
| `dev/CLAUDE.md` | `@README.md` (импорт для Claude Code) |
| `pub/README.md` | Навигация по pub/ |
| `pub/CLAUDE.md` | `@README.md` (импорт для Claude Code) |
| `!context_rules.md` | Этот файл — правила работы с контекстом |
| `!chat_navigation.md` | Навигация для Claude Chat/Projects (таблица поиска) |

---

## 4. Корневой CLAUDE.md

**Назначение:** "Конституция" для Claude Code. Детальный контекст проекта.

**Обязательные секции:**
- Project Overview — краткое описание проекта
- Repository Structure — дерево папок с пояснениями
- Tech Stack — технологии, версии
- Slash Commands — команды типа `/svaib-context`
- Important Rules — критичные правила
- Getting More Context — навигационные подсказки для AI

**Дополнительные секции (для проектов с кодом):**
- Application Architecture — структура приложения
- Design System — цвета, шрифты, компоненты
- Development Workflow — процесс разработки и деплоя
- State Management — управление состоянием
- Data Structure — структура данных
- Key Principles — ключевые принципы проекта
- Maintenance — правила обновления CLAUDE.md

**Про Repository Structure:**
Дерево папок с пояснениями. Правила оформления:
- Язык описаний: английский (CLAUDE.md для AI)
- Краткое понятное описание (2-4 слова)

Какие папки раскрываем до файлов:
- `meta/meta_context/` — ключевые документы проекта
- `dev/dev_context/` — документация продукта
- `dev/src/` — структура приложения (app/, components/, data/)

Какие папки НЕ раскрываем (только название + описание):
- `*/prompts/` — промпты, много файлов
- `meta/research/` — исследования
- `pub/` — публичные материалы

**Про Getting More Context:**
Не дублирование дерева папок, а подсказки "КОГДА → ЧТО читать".
Помогает AI быстро загрузить нужный контекст для типовых задач.
Формат: короткая таблица (5-6 строк), не полный список файлов.

**Важно:** CLAUDE.md становится частью system prompt Claude Code. Держи его актуальным.

---

## 5. Корневой README.md

**Назначение:** Описание проекта для людей и GitHub.

**Что включать:**
- Краткое описание проекта
- Структура папок (таблица)
- Ссылки (сайт, контакты)

---

## 6. README.md папки

**Когда создавать:** папка содержит >3 файлов

**Назначение:** 
- Показать что внутри папки
- Дать краткое описание каждого файла
- Показать связь с другими папками ("соседей")

**Шаблон:**

```markdown
# [Название папки]

> Часть проекта svaib. Полная структура: [../README.md]

## Назначение
[2-3 предложения — зачем эта папка существует]

## Структура
[Дерево подпапок, если есть]

## Файлы

| Файл | Что внутри | Когда читать |
|------|-----------|--------------|
| file.md | Краткое описание | Условие/триггер |

## Связанные папки
- **dev/** — [краткое описание]
- **pub/** — [краткое описание]
```

---

## 7. CLAUDE.md в папках

**Содержимое:** одна строка
```markdown
@README.md
```

**Размещение:** ключевые папки (meta/, dev/, pub/)

**Почему:** Claude Code читает CLAUDE.md автоматически → импортирует README → один источник правды.

---

## 8. Структура файла контекста

### 8.1. Naming Convention

**Типы файлов:**

| Тип | Формат | Пример | Размещение |
|-----|--------|--------|------------|
| Обычный | `короткое_имя.md` | `project_overview.md` | По назначению |
| Исследование | `{topic}_research.md` | `smb_meetings_research.md` | `meta/research/` |
| Архив | `{name}_v{N}_{reason}.md` | `mvp_overview_v1_platform.md` | `meta/z_archive/` |

**Префиксы по назначению:**

| Префикс | Назначение | Примеры |
|---------|------------|---------|
| `product_*` | Файлы про продукт | `product_vision.md`, `product_release.md` |
| `guide_*` | Детальные описания/спецификации | `guide_presentation.md`, `guide_team_patterns.md` |
| `dev_*` | Инструменты разработки | `dev_environment.md` |

**Правило filename vs title:**
**Принцип для RAG:** Filename = поисковый запрос. Claude Chat ищет по названиям файлов, поэтому имя должно содержать слова, которые человек введёт при поиске.
- **Filename** = сжатая суть, стабильная ссылка
- **Title** (в YAML) = развёрнутое описание

✅ `project_overview.md` + "Целостное описание проекта SVAIB"
❌ `file123.md` + "Про котиков"

### 8.2. YAML-заголовок

```yaml
---
title: "Развёрнутое описание файла"
updated: YYYY-MM-DD
version: N
scope: "когда_использовать"
priority: critical/high/medium/low
---
```

**title** — развёрнутое описание содержания

**updated** — дата последнего обновления

**version** — 1 для нового файла, N+1 для обновления

**scope** — когда файл релевантен (рекомендуемые значения):
- Стратегия: `always`, `author_info`, `project_strategy`, `planning`
- Продукт: `product_development`, `client_relations`, `implementation`
- Мастерская: `lab_operations`, `agents_management`, `tools`
- Публикации: `publications`, `community`, `meetings`
- Другие: `progress_tracking` (трекинг результатов)

*Можно создавать новые scope, если существующие не подходят. При создании нового — добавить сюда.*

**priority** — важность файла:
| Уровень | Когда | Примеры |
|---------|-------|---------|
| critical | Системные файлы | !context_rules, technical_infrastructure |
| high | Ключевые документы | project_overview, product_overview |
| medium | Рабочие документы | weekly_progress, clients |
| low | Черновики | drafts, notes |

### 8.3. Тело файла

```markdown
# Заголовок

## Кратко
[несколько предложений — суть документа. С ключевыми словами для RAG — ОБЯЗАТЕЛЬНО!!]

## Связанные файлы
- file1.md — почему связан
- file2.md — почему связан

## Основной раздел 1
[Содержание]

## Основной раздел 2
[Содержание]
```

**Секция "Кратко"** — обязательна. Executive summary для AI и точка входа для RAG-поиска.

**Что включать:**
1. **Что это** — одно предложение, суть документа
2. **Ключевые термины** — слова, по которым будут искать (технологии, роли, процессы)
3. **Связь с контекстом** — как этот документ связан с проектом (опционально)

**Пример хорошей секции:**

```markdown
## Кратко

Архитектура MVP svaib: трёхслойная система (Google Workspace → Supabase → n8n)
для транскрибации встреч и извлечения задач. Описывает SGR-паттерн,
Google Sync Layer, схему данных. Для 3-5 пилотных клиентов.
```

**Почему это работает:**
- Содержит ключевые слова: "архитектура", "MVP", "транскрибация", "встречи", "задачи"
- При поиске "как устроена архитектура" — файл найдётся
- При поиске "транскрибация" — тоже найдётся

**Секция "Связанные файлы"** — граф связей с описанием. Помогает AI понять контекст.

---

## 9. Маркеры [SOURCE] / [REF:]

### Назначение
Один факт упоминается в нескольких файлах → непонятно где правда. Маркеры решают это.

### Синтаксис

```markdown
// В technical_infrastructure.md (источник):
**Стек:** n8n + Supabase + Google API [SOURCE]

// В architecture.md (ссылка):
Используем n8n для автоматизаций [REF: technical_infrastructure.md]
```

### Правила
1. Каждый изменяемый факт имеет ОДИН файл с `[SOURCE]`
2. Все остальные упоминания — через `[REF: файл.md]`
3. При изменении SOURCE → grep → обновить REF

### Поиск ссылок
```bash
grep -r "REF: filename.md" .
```

### Когда использовать
- Факт часто меняется (стек, цены, статусы) → [SOURCE] + [REF:]
- Факт стабильный → можно не маркировать

---

## 10. Связанные файлы vs [SOURCE]/[REF:]

**Это разные механизмы:**

| Механизм | Уровень | Назначение |
|----------|---------|-----------|
| Связанные файлы (секция) | Весь файл | "Этот документ связан с теми" |
| [SOURCE]/[REF:] (в тексте) | Конкретный факт | "Этот факт определён там" |

**Связанные файлы** — показывают граф документов
**[SOURCE]/[REF:]** — показывают источник конкретного факта

---

## 11. Single Source of Truth

### Принцип
- Каждый факт хранится в ОДНОМ файле
- Другие файлы ссылаются через [REF:], не копируют
- При изменении → обновляем только источник [SOURCE]

### Когда обновлять файл
1. **Прямое изменение** — появилась новая информация по теме файла
2. **Устранение коллизии** — связанный файл изменился, текущий противоречит

### Как обновлять
1. Инкремент `version` в YAML (N → N+1)
2. Обновление `updated` на текущую дату
3. После обновления → проверка связанных файлов на коллизии
4. Ссылки между файлами — только по именам, без путей

---

## 12. Разделение правил и промптов

### Принцип
- **context_rules** (этот файл) = "как должны выглядеть файлы"
- **editor_context_prompt** = "как агент работает"

### В этом файле (правила)
- Структура проекта
- YAML-заголовок
- Naming Convention
- Структура файла
- Маркеры [SOURCE]/[REF:]
- Single Source of Truth

### В промпте агента (процесс)
- Режим работы (партнёр, не исполнитель)
- Шаги работы
- Формат ответа
- Критические ограничения
- Проверка на коллизии
- **Ссылка:** "Правила форматирования см. в !context_rules.md"

---

## 13. Команды (точки входа)

- `/svaib-sprint` → движение по MVP спринту (фокус на product_sprint.md)
- `/svaib-dev` → архитектура / разработка (работает с `dev/`)
- `/svaib-context` → форматирование, структура, проверка коллизий (работает с `meta/`)
- `/svaib-knowledge` → база знаний: добавление, поиск, ревизия (работает с `knowledge/`)

Команда = переход в контекст + чтение ключевых файлов.

---

## Структура папок проекта

**Логика разделения:**
- **meta/** — стратегия проекта и продукта (ЧТО, ЗАЧЕМ, КОГДА, КТО)
- **dev/** — разработка и реализация (КАК строить продукт)
- **pub/** — публичные материалы (презентации, выступления)

---
